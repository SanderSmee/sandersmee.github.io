<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><meta name="author" content="Sander Smeman"><meta name="robots" content="all"><title>Custom, optional attributes in spring-restdocs</title><meta name="description" content="Documenting spring restcontrollers with spring-restdocs is a sure way to get great documentation.
It allows one to document API endpoints based on examples used in a test, and document specific fields in a response.
It&amp;#8217;s even possible to document..."><meta name="keywords" content="asciidoc,documentation,spring-restdocs"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//stackpath.bootstrapcdn.com"><link rel="dns-prefetch" href="//use.fontawesome.com"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><script>if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js').then(function(registration) {
            // Registration was successful
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
        }, function(err) {
            // registration failed :(
            console.log('ServiceWorker registration failed: ', err);
        });
    });
}
</script><link rel="alternate" type="application/rss+xml" title="thoughts.toString();" href="/atom.xml"><link rel="stylesheet" href="//use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Encode+Sans:400,800|IBM+Plex+Serif:400,400i,700,700i&amp;display=swap"><link rel="stylesheet" href="/css/style.css?v=1"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/vs2015.min.css"><script>if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-8287349-4', 'auto');
    ga('send', 'pageview');
}</script></head><body><nav class="navbar navbar-custom fixed-top navbar-expand-md"><a class="navbar-brand" href="/"><span>thoughts.toString();</span></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="true" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto"><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/archives">Archive</a></li><li class="nav-item"><a class="nav-link" target="_blank" rel="noopener" href="https://github.com/SanderSmee/sandersmee.github.io">Github</a></li></ul></div></nav><header class="header-section"><div class="intro-header" style="background-image: url(//source.unsplash.com/dC6Pb2JdAqs);"><div class="container"><div class="row justify-content-center"><div class="col-lg-10 col-12"><div class="post-heading"><a class="category" href="/category/Howto/">Howto</a><h1>Custom, optional attributes in spring-restdocs</h1><div class="post-meta"><ul class="list-inline"><li class="list-inline-item"><time datetime="2019-03-20T16:09:20.000Z" itemprop="datePublished">2019-03-20</time></li><li class="list-inline-item">3 minutes read</li></ul></div></div></div></div></div></div></header><main class="container"><div class="row justify-content-center"><div class="col-lg-10 col-12"><article class="blog-post" role="main"><p>Documenting spring restcontrollers with spring-restdocs is a sure way to get great documentation.
It allows one to document API endpoints based on examples used in a test, and document specific fields in a response.
It&#8217;s even possible to document additional attributes of a field in a JSON response.</p>
<span id="more"></span>
<p>Here, from the <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-restdocs/docs/2.0.3.RELEASE/reference/html5/#documenting-your-api-customizing">documentation</a>, is added the attribute <code>constraints</code>, but with one caveat: it&#8217;s missing for one field:</p>
<figure class="listing-block"><figcaption>Listing 1. Spring @WebMvcTest with spring-restdocs</figcaption>
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">.andDo(document("create-user", requestFields(
	attributes(key("title").value("Fields for user creation")),
	fieldWithPath("name").description("The user's name")
		.attributes(key("constraints")
			.value("Must not be null. Must not be empty")),
    fieldWithPath("age").description("The user's age"), <b class="conum">1</b>
	fieldWithPath("email").description("The user's email address")
		.attributes(key("constraints")
			.value("Must be a valid email address")))));</code></pre><ol class="callout-list arabic"><li>An extra field, but without added documentation for the <code>constraints</code> attribute.</li></ol></figure>

<section class="doc-section level-1"><h2>Include the attribute in the documentation</h2><p>By default those additional attributes don&#8217;t appear in the generated documents.
For that to happen, you have to override the spring-restdocs snippets, by placing a snippet on the test-classpath.
In standard project structure this is done, by putting those snippets in <code>src/test/resources/org/springframework/restdocs/templates/asciidoctor</code> per the documentation.</p>
<p>For the request fields, that snippet is then:</p>
<figure class="listing-block"><figcaption>Listing 2. request-fields.snippet</figcaption>
<pre class="highlightjs highlight"><code class="language-mustache hljs" data-lang="mustache">.&#123;&#123; '&#123;&#123;title&#125;&#125;' &#125;&#125;
|===
|Path|Type|Description|Constraints

&#123;&#123; '&#123;&#123; #fields &#125;&#125;' &#125;&#125;
|&#123;&#123; '&#123;&#123;path&#125;&#125;' &#125;&#125;
|&#123;&#123; '&#123;&#123;type&#125;&#125;' &#125;&#125;
|&#123;&#123; '&#123;&#123;description&#125;&#125;' &#125;&#125;
|&#123;&#123; '&#123;&#123;constraints&#125;&#125;' &#125;&#125;

&#123;&#123; '&#123;&#123; /fields &#125;&#125;' &#125;&#125;
|===</code></pre></figure>
<p>But running this test results in an failure reporting that the added attribute is not present:</p>
<div class="listing-block"><pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">org.springframework.restdocs.mustache.MustacheException$Context: No method or field with name 'constraints' on line 9</code></pre></div>
<p>This can be a convenient reminder that you have not completely documented the fields, but if you deliberately omitted the <code>constraint</code> attribute you wouldn&#8217;t want the failure.</p></section>
<section class="doc-section level-1"><h2>Solution</h2><p>To provide a solution for the above problem, I had to search through the reported issues in the spring-restdocs <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-restdocs/">github issues</a> to find the solution:</p>
<figure class="listing-block"><figcaption>Listing 3. request-fields.snippet with adjustment</figcaption>
<pre class="highlightjs highlight"><code class="language-mustache hljs" data-lang="mustache">.&#123;&#123; '&#123;&#123;title&#125;&#125;' &#125;&#125;
|===
|Path|Type|Description|Constraints

&#123;&#123; '&#123;&#123; #fields &#125;&#125;' &#125;&#125;
|&#123;&#123; '&#123;&#123;path&#125;&#125;' &#125;&#125;
|&#123;&#123; '&#123;&#123;type&#125;&#125;' &#125;&#125;
|&#123;&#123; '&#123;&#123;description&#125;&#125;' &#125;&#125;
|&#123;&#123; '&#123;&#123; #constraints &#125;&#125;' &#125;&#125;&#123;&#123; '&#123;&#123;.&#125;&#125;' &#125;&#125;&#123;&#123; '&#123;&#123; /constraints &#125;&#125;' &#125;&#125; <b class="conum">1</b>

&#123;&#123; '&#123;&#123; /fields &#125;&#125;' &#125;&#125;

|===</code></pre><ol class="callout-list arabic"><li>Different mustache notation for the constraints attribute</li></ol></figure>

<p>This uses the mustache <code>.</code> <a target="_blank" rel="noopener" href="https://github.com/samskivert/jmustache#this">special variable</a>. <code>&num;constraints</code> is now treated as a context, and evaluates to false when absent, or an empty list.
But when a value is present, it evaluates and renders that value, which is then referenced as <code>this</code> by the <code>.</code>.
This might be better explained in the <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-restdocs/issues/291#issuecomment-433998972">comments</a> of issue &num;291 .</p></section><section class="post-tags"><div><a class="tag post-meta badge badge-pill badge-primary" href="/tags/asciidoc/">#asciidoc</a><a class="tag post-meta badge badge-pill badge-primary" href="/tags/documentation/">#documentation</a><a class="tag post-meta badge badge-pill badge-primary" href="/tags/spring-restdocs/">#spring-restdocs</a></div></section></article><nav class="pagination justify-content-center" role="pagination"><li class="previous page-item"><a class="float-right page-link" href="/testable-architecture/">&larr; Previous post</a></li></nav></div></div></main><footer class="site-footer container-fluid"><div class="row justify-content-center"><div class="col-10"><div class="row"><section class="col-lg-4"><h5>thoughts.toString(); Â© 2021</h5><p><em>"My thoughts.toString(); For you to explore"</em></p><p>This work is licensed under a <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
</p></section><section class="col-lg-4"><h5 class="marked">Recent articles</h5><div class="recent-posts"><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/custom-attributes-in-spring-restdocs/">Custom, optional attributes in spring-restdocs</a></li><li class="post-list-item"><a class="post-list-link" href="/testable-architecture/">Testable architecture</a></li><li class="post-list-item"><a class="post-list-link" href="/reduce-code-noise-ratio-maven-poms/">Reduce the code to noise ratio of maven POMs</a></li></ul></div></section><section class="col-lg-4"><h5 class="marked">Stay connected</h5><div class="social-links"><ul class="list-inline"><li class="list-inline-item"><a href="/atom.xml" title="RSS" onclick="window.open(this.href);return false;"><span class="fas fa-rss"></span></a></li><li class="list-inline-item"><a target="_blank" rel="noopener" href="https://twitter.com/osusso" title="Twitter" onclick="window.open(this.href);return false;"><span class="fab fa-twitter"></span></a></li><li class="list-inline-item"><a target="_blank" rel="noopener" href="https://github.com/sandersmee/sandersmee.github.io" title="Github" onclick="window.open(this.href);return false;"><span class="fab fa-github"></span></a></li><li class="list-inline-item"><a href="mailto:sander.smeman@gmail.com" title="mail" onclick="window.open(this.href);return false;"><span class="fas fa-envelope"></span></a></li><li class="list-inline-item"><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/sandersmeman/" title="linkedin" onclick="window.open(this.href);return false;"><span class="fab fa-linkedin"></span></a></li></ul></div><h5 class="marked">Meta</h5><ul class="list-inline"><li class="list-inline-item"><a href="/statistics">Statistics</a></li><li class="list-inline-item"><a target="_blank" rel="noopener" href="https://stats.uptimerobot.com/Q7LzzFqKE">Uptime</a></li></ul></section></div></div></div></footer><script src="//code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script><script src="//cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script><script src="//stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script><script src="/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>